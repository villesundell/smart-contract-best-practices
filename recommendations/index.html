



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://github.com/ConsenSys/smart-contract-best-practices/recommendations/">
      
      
        <meta name="author" content="ConsenSys">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.5">
    
    
      
        <title>Recommendations for Smart Contract Security in Solidity - Ethereum Smart Contract Best Practices</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.bcabdff3.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Ethereum Smart Contract Best Practices" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Ethereum Smart Contract Best Practices
              </span>
              <span class="md-header-nav__topic">
                Recommendations for Smart Contract Security in Solidity
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ConsenSys/smart-contract-best-practices/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Ethereum Smart Contract Best Practices
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ConsenSys/smart-contract-best-practices/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../general_philosophy/" title="General Philosophy" class="md-nav__link">
      General Philosophy
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Recommendations for Smart Contract Security in Solidity
      </label>
    
    <a href="./" title="Recommendations for Smart Contract Security in Solidity" class="md-nav__link md-nav__link--active">
      Recommendations for Smart Contract Security in Solidity
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#protocol-specific-recommendations" title="Protocol specific recommendations" class="md-nav__link">
    Protocol specific recommendations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-calls" title="External Calls" class="md-nav__link">
    External Calls
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-caution-when-making-external-calls" title="Use caution when making external calls" class="md-nav__link">
    Use caution when making external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mark-untrusted-contracts" title="Mark untrusted contracts" class="md-nav__link">
    Mark untrusted contracts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-state-changes-after-external-calls" title="Avoid state changes after external calls" class="md-nav__link">
    Avoid state changes after external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue" title="Be aware of the tradeoffs between send(), transfer(), and call.value()()" class="md-nav__link">
    Be aware of the tradeoffs between send(), transfer(), and call.value()()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-errors-in-external-calls" title="Handle errors in external calls" class="md-nav__link">
    Handle errors in external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#favor-pull-over-push-for-external-calls" title="Favor pull over push for external calls" class="md-nav__link">
    Favor pull over push for external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-delegatecall-to-untrusted-code" title="Don't delegatecall to untrusted code" class="md-nav__link">
    Don't delegatecall to untrusted code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remember-that-on-chain-data-is-public" title="Remember that on-chain data is public" class="md-nav__link">
    Remember that on-chain data is public
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-2-party-or-n-party-contracts-beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return" title="In 2-party or N-party contracts, beware of the possibility that some participants may "drop offline" and not return" class="md-nav__link">
    In 2-party or N-party contracts, beware of the possibility that some participants may "drop offline" and not return
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beware-of-negation-of-the-most-negative-signed-integer" title="Beware of negation of the most negative signed integer" class="md-nav__link">
    Beware of negation of the most negative signed integer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solidity-specific-recommendations" title="Solidity specific recommendations" class="md-nav__link">
    Solidity specific recommendations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enforce-invariants-with-assert" title="Enforce invariants with assert()" class="md-nav__link">
    Enforce invariants with assert()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-assert-require-revert-properly" title="Use assert(), require(), revert() properly" class="md-nav__link">
    Use assert(), require(), revert() properly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-modifiers-only-for-assertions" title="Use modifiers only for assertions" class="md-nav__link">
    Use modifiers only for assertions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beware-rounding-with-integer-division" title="Beware rounding with integer division" class="md-nav__link">
    Beware rounding with integer division
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Remember that Ether can be forcibly sent to an account" class="md-nav__link">
    Remember that Ether can be forcibly sent to an account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Be aware of the tradeoffs between abstract contracts and interfaces" class="md-nav__link">
    Be aware of the tradeoffs between abstract contracts and interfaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-fallback-functions-simple" title="Keep fallback functions simple" class="md-nav__link">
    Keep fallback functions simple
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-data-length-in-fallback-functions" title="Check data length in fallback functions" class="md-nav__link">
    Check data length in fallback functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicitly-mark-payable-functions-and-state-variables" title="Explicitly mark payable functions and state variables" class="md-nav__link">
    Explicitly mark payable functions and state variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Explicitly mark visibility in functions and state variables" class="md-nav__link">
    Explicitly mark visibility in functions and state variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lock-pragmas-to-specific-compiler-version" title="Lock pragmas to specific compiler version" class="md-nav__link">
    Lock pragmas to specific compiler version
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exception" title="Exception" class="md-nav__link">
    Exception
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-events-to-monitor-contract-activity" title="Use events to monitor contract activity" class="md-nav__link">
    Use events to monitor contract activity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefer-newer-solidity-constructs" title="Prefer newer Solidity constructs" class="md-nav__link">
    Prefer newer Solidity constructs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-that-built-ins-can-be-shadowed" title="Be aware that 'Built-ins' can be shadowed" class="md-nav__link">
    Be aware that 'Built-ins' can be shadowed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-using-txorigin" title="Avoid using tx.origin" class="md-nav__link">
    Avoid using tx.origin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp-dependence" title="Timestamp Dependence" class="md-nav__link">
    Timestamp Dependence
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timestamp-manipulation" title="Timestamp Manipulation" class="md-nav__link">
    Timestamp Manipulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-15-second-rule" title="The 15-second Rule" class="md-nav__link">
    The 15-second Rule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-blocknumber-as-a-timestamp" title="Avoid using block.number as a timestamp" class="md-nav__link">
    Avoid using block.number as a timestamp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-inheritance-caution" title="Multiple Inheritance Caution" class="md-nav__link">
    Multiple Inheritance Caution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-interface-type-instead-of-the-address-for-type-safety" title="Use interface type instead of the address for type safety" class="md-nav__link">
    Use interface type instead of the address for type safety
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-using-extcodesize-to-check-for-externally-owned-accounts" title="Avoid using extcodesize to check for Externally Owned Accounts" class="md-nav__link">
    Avoid using extcodesize to check for Externally Owned Accounts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-recommendations" title="Deprecated/historical recommendations" class="md-nav__link">
    Deprecated/historical recommendations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beware-division-by-zero-solidity-04" title="Beware division by zero (Solidity &lt; 0.4)" class="md-nav__link">
    Beware division by zero (Solidity &lt; 0.4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#differentiate-functions-and-events-solidity-0421" title="Differentiate functions and events (Solidity &lt; 0.4.21)" class="md-nav__link">
    Differentiate functions and events (Solidity &lt; 0.4.21)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../known_attacks/" title="Known Attacks" class="md-nav__link">
      Known Attacks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../software_engineering/" title="Software Engineering Techniques" class="md-nav__link">
      Software Engineering Techniques
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../tokens/" title="Token specific recommendations" class="md-nav__link">
      Token specific recommendations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../documentation_procedures/" title="Documentation and Procedures" class="md-nav__link">
      Documentation and Procedures
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_tools/" title="Security Tools" class="md-nav__link">
      Security Tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_eips/" title="Security EIPs" class="md-nav__link">
      Security EIPs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_notifications/" title="Security Notifications" class="md-nav__link">
      Security Notifications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bibliography/" title="Smart Contract Security Bibliography" class="md-nav__link">
      Smart Contract Security Bibliography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bug_bounty_list/" title="List of Smart Contract Bug Bounty Programs" class="md-nav__link">
      List of Smart Contract Bug Bounty Programs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/reviewers/" title="Reviewers" class="md-nav__link">
      Reviewers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#protocol-specific-recommendations" title="Protocol specific recommendations" class="md-nav__link">
    Protocol specific recommendations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-calls" title="External Calls" class="md-nav__link">
    External Calls
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-caution-when-making-external-calls" title="Use caution when making external calls" class="md-nav__link">
    Use caution when making external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mark-untrusted-contracts" title="Mark untrusted contracts" class="md-nav__link">
    Mark untrusted contracts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-state-changes-after-external-calls" title="Avoid state changes after external calls" class="md-nav__link">
    Avoid state changes after external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue" title="Be aware of the tradeoffs between send(), transfer(), and call.value()()" class="md-nav__link">
    Be aware of the tradeoffs between send(), transfer(), and call.value()()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-errors-in-external-calls" title="Handle errors in external calls" class="md-nav__link">
    Handle errors in external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#favor-pull-over-push-for-external-calls" title="Favor pull over push for external calls" class="md-nav__link">
    Favor pull over push for external calls
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dont-delegatecall-to-untrusted-code" title="Don't delegatecall to untrusted code" class="md-nav__link">
    Don't delegatecall to untrusted code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remember-that-on-chain-data-is-public" title="Remember that on-chain data is public" class="md-nav__link">
    Remember that on-chain data is public
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#in-2-party-or-n-party-contracts-beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return" title="In 2-party or N-party contracts, beware of the possibility that some participants may "drop offline" and not return" class="md-nav__link">
    In 2-party or N-party contracts, beware of the possibility that some participants may "drop offline" and not return
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beware-of-negation-of-the-most-negative-signed-integer" title="Beware of negation of the most negative signed integer" class="md-nav__link">
    Beware of negation of the most negative signed integer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solidity-specific-recommendations" title="Solidity specific recommendations" class="md-nav__link">
    Solidity specific recommendations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enforce-invariants-with-assert" title="Enforce invariants with assert()" class="md-nav__link">
    Enforce invariants with assert()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-assert-require-revert-properly" title="Use assert(), require(), revert() properly" class="md-nav__link">
    Use assert(), require(), revert() properly
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-modifiers-only-for-assertions" title="Use modifiers only for assertions" class="md-nav__link">
    Use modifiers only for assertions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#beware-rounding-with-integer-division" title="Beware rounding with integer division" class="md-nav__link">
    Beware rounding with integer division
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Remember that Ether can be forcibly sent to an account" class="md-nav__link">
    Remember that Ether can be forcibly sent to an account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Be aware of the tradeoffs between abstract contracts and interfaces" class="md-nav__link">
    Be aware of the tradeoffs between abstract contracts and interfaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-fallback-functions-simple" title="Keep fallback functions simple" class="md-nav__link">
    Keep fallback functions simple
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#check-data-length-in-fallback-functions" title="Check data length in fallback functions" class="md-nav__link">
    Check data length in fallback functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicitly-mark-payable-functions-and-state-variables" title="Explicitly mark payable functions and state variables" class="md-nav__link">
    Explicitly mark payable functions and state variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Explicitly mark visibility in functions and state variables" class="md-nav__link">
    Explicitly mark visibility in functions and state variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lock-pragmas-to-specific-compiler-version" title="Lock pragmas to specific compiler version" class="md-nav__link">
    Lock pragmas to specific compiler version
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exception" title="Exception" class="md-nav__link">
    Exception
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-events-to-monitor-contract-activity" title="Use events to monitor contract activity" class="md-nav__link">
    Use events to monitor contract activity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prefer-newer-solidity-constructs" title="Prefer newer Solidity constructs" class="md-nav__link">
    Prefer newer Solidity constructs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#be-aware-that-built-ins-can-be-shadowed" title="Be aware that 'Built-ins' can be shadowed" class="md-nav__link">
    Be aware that 'Built-ins' can be shadowed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-using-txorigin" title="Avoid using tx.origin" class="md-nav__link">
    Avoid using tx.origin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#timestamp-dependence" title="Timestamp Dependence" class="md-nav__link">
    Timestamp Dependence
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#timestamp-manipulation" title="Timestamp Manipulation" class="md-nav__link">
    Timestamp Manipulation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-15-second-rule" title="The 15-second Rule" class="md-nav__link">
    The 15-second Rule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avoid-using-blocknumber-as-a-timestamp" title="Avoid using block.number as a timestamp" class="md-nav__link">
    Avoid using block.number as a timestamp
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-inheritance-caution" title="Multiple Inheritance Caution" class="md-nav__link">
    Multiple Inheritance Caution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-interface-type-instead-of-the-address-for-type-safety" title="Use interface type instead of the address for type safety" class="md-nav__link">
    Use interface type instead of the address for type safety
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#avoid-using-extcodesize-to-check-for-externally-owned-accounts" title="Avoid using extcodesize to check for Externally Owned Accounts" class="md-nav__link">
    Avoid using extcodesize to check for Externally Owned Accounts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deprecatedhistorical-recommendations" title="Deprecated/historical recommendations" class="md-nav__link">
    Deprecated/historical recommendations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#beware-division-by-zero-solidity-04" title="Beware division by zero (Solidity &lt; 0.4)" class="md-nav__link">
    Beware division by zero (Solidity &lt; 0.4)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#differentiate-functions-and-events-solidity-0421" title="Differentiate functions and events (Solidity &lt; 0.4.21)" class="md-nav__link">
    Differentiate functions and events (Solidity &lt; 0.4.21)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ConsenSys/smart-contract-best-practices/edit/master/docs/recommendations.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Recommendations for Smart Contract Security in Solidity</h1>
                
                <p>This page demonstrates a number of solidity patterns which should generally be followed when writing smart contracts.</p>
<h2 id="protocol-specific-recommendations">Protocol specific recommendations<a class="headerlink" href="#protocol-specific-recommendations" title="Permanent link">&para;</a></h2>
<h3 id="_1"><!-- --><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>The following recommendations apply to the development of any contract system on Ethereum.</p>
<h2 id="external-calls">External Calls<a class="headerlink" href="#external-calls" title="Permanent link">&para;</a></h2>
<h3 id="use-caution-when-making-external-calls">Use caution when making external calls<a class="headerlink" href="#use-caution-when-making-external-calls" title="Permanent link">&para;</a></h3>
<p>Calls to untrusted contracts can introduce several unexpected risks or errors. External calls may execute malicious code in that contract <em>or</em> any other contract that it depends upon. As such, every external call should be treated as a potential security risk. When it is not possible, or undesirable to remove external calls, use the recommendations in the rest of this section to minimize the danger.</p>
<h3 id="mark-untrusted-contracts">Mark untrusted contracts<a class="headerlink" href="#mark-untrusted-contracts" title="Permanent link">&para;</a></h3>
<p>When interacting with external contracts, name your variables, methods, and contract interfaces in a way that makes it clear that interacting with them is potentially unsafe. This applies to your own functions that call external contracts.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="n">Bank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// Unclear whether trusted or untrusted</span>

<span class="kd">function</span> <span class="n">makeWithdrawal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Isn&#39;t clear that this function is potentially unsafe</span>
    <span class="n">Bank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="n">UntrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// untrusted external call</span>
<span class="n">TrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// external but trusted bank contract maintained by XYZ Corp</span>

<span class="kd">function</span> <span class="n">makeUntrustedWithdrawal</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UntrustedBank</span><span class="p">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h3 id="avoid-state-changes-after-external-calls">Avoid state changes after external calls<a class="headerlink" href="#avoid-state-changes-after-external-calls" title="Permanent link">&para;</a></h3>
<p>Whether using <em>raw calls</em> (of the form <code>someAddress.call()</code>) or <em>contract calls</em> (of the form <code>ExternalContract.someMethod()</code>), assume that malicious code might execute. Even if <code>ExternalContract</code> is not malicious, malicious code can be executed by any contracts <em>it</em> calls.</p>
<p>One particular danger is malicious code may hijack the control flow, leading to vulnerabilities due to reentrancy. (See <a href="../known_attacks#reentrancy">Reentrancy</a> for a fuller discussion of this problem).</p>
<p>If you are making a call to an untrusted external contract, <em>avoid state changes after the call</em>. This pattern is also sometimes known as the <a href="http://solidity.readthedocs.io/en/develop/security-considerations.html?highlight=check%20effects#use-the-checks-effects-interactions-pattern">checks-effects-interactions pattern</a>.</p>
<h3 id="be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue">Be aware of the tradeoffs between <code>send()</code>, <code>transfer()</code>, and <code>call.value()()</code><a class="headerlink" href="#be-aware-of-the-tradeoffs-between-send-transfer-and-callvalue" title="Permanent link">&para;</a></h3>
<p>When sending ether be aware of the relative tradeoffs between the use of
<code>someAddress.send()</code>, <code>someAddress.transfer()</code>, and <code>someAddress.call.value()()</code>.</p>
<ul>
<li><code>someAddress.send()</code>and <code>someAddress.transfer()</code> are considered <em>safe</em> against <a href="../known_attacks#reentrancy">reentrancy</a>.
    While these methods still trigger code execution, the called contract is
    only given a stipend of 2,300 gas which is currently only enough to log an
    event.</li>
<li><code>x.transfer(y)</code> is equivalent to <code>require(x.send(y));</code>, it will automatically revert if the send fails.</li>
<li><code>someAddress.call.value(y)()</code> will send the provided ether and trigger code execution.<br />
    The executed code is given all available gas for execution making this type of value transfer <em>unsafe</em> against reentrancy.</li>
</ul>
<p>Using <code>send()</code> or <code>transfer()</code> will prevent reentrancy but it does so at the cost of being incompatible with any contract whose fallback function requires more than 2,300 gas. It is also possible to use <code>someAddress.call.value(ethAmount).gas(gasAmount)()</code> to forward a custom amount of gas.</p>
<p>One pattern that attempts to balance this trade-off is to implement both
a <a href="#favor-pull-over-push-for-external-calls"><em>push</em> and <em>pull</em></a> mechanism, using <code>send()</code> or <code>transfer()</code>
for the <em>push</em> component and <code>call.value()()</code> for the <em>pull</em> component.</p>
<p>It is worth pointing out that exclusive use of <code>send()</code> or <code>transfer()</code> for value transfers
does not itself make a contract safe against reentrancy but only makes those
specific value transfers safe against reentrancy.</p>
<h3 id="handle-errors-in-external-calls">Handle errors in external calls<a class="headerlink" href="#handle-errors-in-external-calls" title="Permanent link">&para;</a></h3>
<p>Solidity offers low-level call methods that work on raw addresses: <code>address.call()</code>, <code>address.callcode()</code>, <code>address.delegatecall()</code>, and <code>address.send()</code>. These low-level methods never throw an exception, but will return <code>false</code> if the call encounters an exception. On the other hand, <em>contract calls</em> (e.g., <code>ExternalContract.doSomething()</code>) will automatically propagate a throw (for example, <code>ExternalContract.doSomething()</code> will also <code>throw</code> if <code>doSomething()</code> throws).</p>
<p>If you choose to use the low-level call methods, make sure to handle the possibility that the call will fail, by checking the return value.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="n">someAddress</span><span class="p">.</span><span class="nb">send</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span>
<span class="n">someAddress</span><span class="p">.</span><span class="nb">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">55</span><span class="p">)();</span> <span class="c1">// this is doubly dangerous, as it will forward all remaining gas and doesn&#39;t check for result</span>
<span class="n">someAddress</span><span class="p">.</span><span class="nb">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">100</span><span class="p">)(</span><span class="kt">bytes4</span><span class="p">(</span><span class="nf">sha3</span><span class="p">(</span><span class="s">&quot;deposit()&quot;</span><span class="p">)));</span> <span class="c1">// if deposit throws an exception, the raw call() will only return false and transaction will NOT be reverted</span>

<span class="c1">// good</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">someAddress</span><span class="p">.</span><span class="nb">send</span><span class="p">(</span><span class="mi">55</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// handle failure code</span>
<span class="p">}</span>

<span class="n">ExternalContract</span><span class="p">(</span><span class="n">someAddress</span><span class="p">).</span><span class="n">deposit</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</pre></div>

<h3 id="favor-pull-over-push-for-external-calls">Favor <em>pull</em> over <em>push</em> for external calls<a class="headerlink" href="#favor-pull-over-push-for-external-calls" title="Permanent link">&para;</a></h3>
<p>External calls can fail accidentally or deliberately. To minimize the damage caused by such failures, it is often better to isolate each external call into its own transaction that can be initiated by the recipient of the call. This is especially relevant for payments, where it is better to let users withdraw funds rather than push funds to them automatically. (This also reduces the chance of <a href="../known_attacks#dos-with-block-gas-limit">problems with the gas limit</a>.)  Avoid combining multiple <code>send()</code> calls in a single transaction.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">contract</span> <span class="n">auction</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">highestBid</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">highestBid</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">highestBidder</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">highestBidder</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">highestBid</span><span class="p">);</span> <span class="c1">// if this call consistently fails, no one else can bid</span>
        <span class="p">}</span>

       <span class="n">highestBidder</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
       <span class="n">highestBid</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">contract</span> <span class="n">auction</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">highestBid</span><span class="p">;</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">refunds</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="n">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">highestBid</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">highestBidder</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">refunds</span><span class="p">[</span><span class="n">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="n">highestBid</span><span class="p">;</span> <span class="c1">// record the refund that this user can claim</span>
        <span class="p">}</span>

        <span class="n">highestBidder</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
        <span class="n">highestBid</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">withdrawRefund</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">refund</span> <span class="o">=</span> <span class="n">refunds</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">];</span>
        <span class="n">refunds</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">refund</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3 id="dont-delegatecall-to-untrusted-code">Don't delegatecall to untrusted code<a class="headerlink" href="#dont-delegatecall-to-untrusted-code" title="Permanent link">&para;</a></h3>
<p>The <code>delegatecall</code> function is used to call functions from other contracts as if they belong to the caller contract. Thus the callee may change the state of the calling address. This may be insecure. An example below shows how using <code>delegatecall</code> can lead to the destruction of the contract and loss of its balance.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Destructor</span>
<span class="p">{</span>
    <span class="kd">function</span> <span class="n">doWork</span><span class="p">()</span> <span class="kr">external</span>
    <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Worker</span>
<span class="p">{</span>
    <span class="kd">function</span> <span class="n">doWork</span><span class="p">(</span><span class="kt">address</span> <span class="n">_internalWorker</span><span class="p">)</span> <span class="kr">public</span>
    <span class="p">{</span>
        <span class="c1">// unsafe</span>
        <span class="n">_internalWorker</span><span class="p">.</span><span class="nb">delegatecall</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="n">keccak256</span><span class="p">(</span><span class="s">&quot;doWork()&quot;</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>If <code>Worker.doWork()</code> is called with the address of the deployed <code>Destructor</code> contract as an argument, the <code>Worker</code> contract will self-destruct. Delegate execution only to trusted contracts, and <strong>never to a user supplied address</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Don't assume contracts are created with zero balance
  An attacker can send ether to the address of a contract before it is created.  Contracts should not assume that its initial state contains a zero balance.  See <a href="https://github.com/ConsenSys/smart-contract-best-practices/issues/61">issue 61</a> for more details.</p>
</div>
<h2 id="remember-that-on-chain-data-is-public">Remember that on-chain data is public<a class="headerlink" href="#remember-that-on-chain-data-is-public" title="Permanent link">&para;</a></h2>
<p>Many applications require submitted data to be private up until some point in time in order to work. Games (eg. on-chain rock-paper-scissors) and auction mechanisms (eg. sealed-bid <a href="https://en.wikipedia.org/wiki/Vickrey_auction">Vickrey auctions</a>) are two major categories of examples. If you are building an application where privacy is an issue, make sure you avoid requiring users to publish information too early. The best strategy is to use <a href="https://en.wikipedia.org/wiki/Commitment_scheme">commitment schemes</a> with separate phases: first commit using the hash of the values and in a later phase revealing the values.</p>
<p>Examples:</p>
<ul>
<li>In rock paper scissors, require both players to submit a hash of their intended move first, then require both players to submit their move; if the submitted move does not match the hash throw it out.</li>
<li>In an auction, require players to submit a hash of their bid value in an initial phase (along with a deposit greater than their bid value), and then submit their auction bid value in the second phase.</li>
<li>When developing an application that depends on a random number generator, the order should always be (1) players submit moves, (2) random number generated, (3) players paid out. The method by which random numbers are generated is itself an area of active research; current best-in-class solutions include Bitcoin block headers (verified through <a href="http://btcrelay.org">http://btcrelay.org</a>), hash-commit-reveal schemes (ie. one party generates a number, publishes its hash to "commit" to the value, and then reveals the value later) and <a href="http://github.com/randao/randao">RANDAO</a>. As Ethereum is a deterministic protocol, no variable within the protocol could be used as an unpredictable random number. Also be aware that miners are in some extent in control of the <code>block.blockhash()</code> value<sup><a href='https://ethereum.stackexchange.com/questions/419/when-can-blockhash-be-safely-used-for-a-random-number-when-would-it-be-unsafe'>*</a></sup>.</li>
</ul>
<h2 id="in-2-party-or-n-party-contracts-beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return">In 2-party or N-party contracts, beware of the possibility that some participants may "drop offline" and not return<a class="headerlink" href="#in-2-party-or-n-party-contracts-beware-of-the-possibility-that-some-participants-may-drop-offline-and-not-return" title="Permanent link">&para;</a></h2>
<p>Do not make refund or claim processes dependent on a specific party performing a particular action with no other way of getting the funds out. For example, in a rock-paper-scissors game, one common mistake is to not make a payout until both players submit their moves; however, a malicious player can "grief" the other by simply never submitting their move - in fact, if a player sees the other player's revealed move and determines that they lost, they have no reason to submit their own move at all. This issue may also arise in the context of state channel settlement. When such situations are an issue, (1) provide a way of circumventing non-participating participants, perhaps through a time limit, and (2) consider adding an additional economic incentive for participants to submit information in all of the situations in which they are supposed to do so.</p>
<h2 id="beware-of-negation-of-the-most-negative-signed-integer">Beware of negation of the most negative signed integer<a class="headerlink" href="#beware-of-negation-of-the-most-negative-signed-integer" title="Permanent link">&para;</a></h2>
<p>Solidity provides several types to work with signed integers. Like in most programming languages, in Solidity a signed integer with <code>N</code> bits can represent values from <code>-2^(N-1)</code> to <code>2^(N-1)-1</code>. This means that there is no positive equivalent for the <code>MIN_INT</code>. Negation is implemented as finding the two's complement of a number, so the negation of the most negative number <a href="https://en.wikipedia.org/wiki/Two%27s_complement#Most_negative_number">will result in the same number</a>.</p>
<p>This is true for all signed integer types in Solidity (<code>int8</code>, <code>int16</code>, ..., <code>int256</code>).</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Negation</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">negate8</span><span class="p">(</span><span class="kt">int8</span> <span class="n">_i</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">int8</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">negate16</span><span class="p">(</span><span class="kt">int16</span> <span class="n">_i</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">int16</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int8</span> <span class="kr">public</span> <span class="n">a</span> <span class="o">=</span> <span class="n">negate8</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">);</span> <span class="c1">// -128</span>
    <span class="kt">int16</span> <span class="kr">public</span> <span class="n">b</span> <span class="o">=</span> <span class="n">negate16</span><span class="p">(</span><span class="o">-</span><span class="mi">128</span><span class="p">);</span> <span class="c1">// 128</span>
    <span class="kt">int16</span> <span class="kr">public</span> <span class="n">c</span> <span class="o">=</span> <span class="n">negate16</span><span class="p">(</span><span class="o">-</span><span class="mi">32768</span><span class="p">);</span> <span class="c1">// -32768</span>
<span class="p">}</span>
</pre></div>

<p>One way to handle this is to check the value of a variable before negation and throw if it's equal to the <code>MIN_INT</code>. Another option is to make sure that the most negative number will never be achieved by using a type with a higher capacity (e.g. <code>int32</code> instead of <code>int16</code>).</p>
<p>A similar issue with <code>int</code> types occurs when <code>MIN_INT</code> is multiplied or divided by <code>-1</code>.</p>
<h2 id="solidity-specific-recommendations">Solidity specific recommendations<a class="headerlink" href="#solidity-specific-recommendations" title="Permanent link">&para;</a></h2>
<h3 id="_2"><!-- --><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>The following recommendations are specific to Solidity, but may also be instructive for developing smart contracts in other languages.</p>
<h2 id="enforce-invariants-with-assert">Enforce invariants with <code>assert()</code><a class="headerlink" href="#enforce-invariants-with-assert" title="Permanent link">&para;</a></h2>
<p>An assert guard triggers when an assertion fails - such as an invariant property changing. For example, the token to ether issuance ratio, in a token issuance contract, may be fixed. You can verify that this is the case at all times with an <code>assert()</code>. Assert guards should often be combined with other techniques, such as pausing the contract and allowing upgrades. (Otherwise, you may end up stuck, with an assertion that is always failing.)</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">balanceOf</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">totalSupply</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">balanceOf</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="n">totalSupply</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="n">assert</span><span class="p">(</span><span class="nb">this</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="n">totalSupply</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Note that the assertion is <em>not</em> a strict equality of the balance because the contract can be <a href="#remember-that-ether-can-be-forcibly-sent-to-an-account">forcibly sent ether</a> without going through the <code>deposit()</code> function!</p>
<h2 id="use-assert-require-revert-properly">Use <code>assert()</code>, <code>require()</code>, <code>revert()</code> properly<a class="headerlink" href="#use-assert-require-revert-properly" title="Permanent link">&para;</a></h2>
<p>In Solidity 0.4.10 <code>assert()</code> and <code>require()</code> were introduced.</p>
<blockquote>
<p>The convenience functions <strong>assert</strong> and <strong>require</strong> can be used to check for conditions and throw an exception if the condition is not met.</p>
<p>The <strong>assert</strong> function should only be used to test for internal errors, and to check invariants.</p>
<p>The <strong>require</strong> function should be used to ensure valid conditions, such as inputs, or contract state variables are met, or to validate return values from calls to external contracts. <sup><a href='https://solidity.readthedocs.io/en/latest/control-structures.html#error-handling-assert-require-revert-and-exceptions'>*</a></sup></p>
</blockquote>
<p>Following this paradigm allows formal analysis tools to verify that the invalid opcode can never be reached: meaning no invariants in the code are violated and that the code is formally verified.</p>
<div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Sharer</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">sendHalf</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nb">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Even value required.&quot;</span><span class="p">);</span> <span class="c1">//Require() can have an optional message string</span>
        <span class="kt">uint</span> <span class="n">balanceBeforeTransfer</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
        <span class="n">addr</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="c1">// Since transfer throws an exception on failure and</span>
        <span class="c1">// cannot call back here, there should be no way for us to</span>
        <span class="c1">// still have half of the money.</span>
        <span class="n">assert</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">==</span> <span class="n">balanceBeforeTransfer</span> <span class="o">-</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// used for internal error checking</span>
        <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2 id="use-modifiers-only-for-assertions">Use modifiers only for assertions<a class="headerlink" href="#use-modifiers-only-for-assertions" title="Permanent link">&para;</a></h2>
<p>The code inside a modifier is usually executed before the function body, so any state changes or external calls will violate the <a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#use-the-checks-effects-interactions-pattern">Checks-Effects-Interactions</a> pattern. Moreover, these statements may also remain unnoticed by the developer, as the code for modifier may be far from the function declaration. For example, an external call in modifier can lead to the reentrancy attack:</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Registry</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">isVoter</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Code</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Election</span> <span class="p">{</span>
    <span class="n">Registry</span> <span class="n">registry</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">isEligible</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">require</span><span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="n">isVoter</span><span class="p">(</span><span class="n">_addr</span><span class="p">));</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">vote</span><span class="p">()</span> <span class="n">isEligible</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Code</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In this case, the <code>Registry</code> contract can make a reentracy attack by calling <code>Election.vote()</code> inside <code>isVoter()</code>.</p>
<p>Use <a href="https://solidity.readthedocs.io/en/develop/contracts.html#function-modifiers">modifiers</a> to replace duplicate condition checks in multiple functions, such as <code>isOwner()</code>, otherwise use <code>require</code> or <code>revert</code> inside the function. This makes your smart contract code more readable and easier to audit.</p>
<h2 id="beware-rounding-with-integer-division">Beware rounding with integer division<a class="headerlink" href="#beware-rounding-with-integer-division" title="Permanent link">&para;</a></h2>
<p>All integer division rounds down to the nearest integer. If you need more precision, consider using a multiplier, or store both the numerator and denominator.</p>
<p>(In the future, Solidity will have a <a href="https://solidity.readthedocs.io/en/develop/types.html#fixed-point-numbers">fixed-point</a> type, which will make this easier.)</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// Result is 2, all integer divison rounds DOWN to the nearest integer</span>
</pre></div>

<p>Using a multiplier prevents rounding down, this multiplier needs to be accounted for when working with x in the future:</p>
<div class="highlight"><pre><span></span><span class="c1">// good</span>
<span class="kt">uint</span> <span class="n">multiplier</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>

<p>Storing the numerator and denominator means you can calculate the result of <code>numerator/denominator</code> off-chain:
<div class="highlight"><pre><span></span><span class="c1">// good</span>
<span class="kt">uint</span> <span class="n">numerator</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">denominator</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</pre></div></p>
<h2 id="remember-that-ether-can-be-forcibly-sent-to-an-account">Remember that Ether can be forcibly sent to an account<a class="headerlink" href="#remember-that-ether-can-be-forcibly-sent-to-an-account" title="Permanent link">&para;</a></h2>
<p>Beware of coding an invariant that strictly checks the balance of a contract.</p>
<p>An attacker can forcibly send ether to any account and this cannot be prevented (not even with a fallback function that does a <code>revert()</code>).</p>
<p>The attacker can do this by creating a contract, funding it with 1 wei, and invoking
<code>selfdestruct(victimAddress)</code>.  No code is invoked in <code>victimAddress</code>, so it
cannot be prevented. This is also true for</p>
<h2 id="be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces">Be aware of the tradeoffs between abstract contracts and interfaces<a class="headerlink" href="#be-aware-of-the-tradeoffs-between-abstract-contracts-and-interfaces" title="Permanent link">&para;</a></h2>
<p>Both interfaces and abstract contracts provide one with a customizable and re-usable approach for smart contracts. Interfaces, which were introduced in Solidity 0.4.11, are similar to abstract contracts but cannot have any functions implemented. Interfaces also have limitations such as not being able to access storage or inherit from other interfaces which generally makes abstract contracts more practical. Although, interfaces are certainly useful for designing contracts prior to implementation. Additionally, it is important to keep in mind that if a contract inherits from an abstract contract it must implement all non-implemented functions via overriding or it will be abstract as well.</p>
<h2 id="keep-fallback-functions-simple">Keep fallback functions simple<a class="headerlink" href="#keep-fallback-functions-simple" title="Permanent link">&para;</a></h2>
<p><a href="http://solidity.readthedocs.io/en/latest/contracts.html#fallback-function">Fallback functions</a> are called when a contract is sent a message with no arguments (or when no function matches), and only has access to 2,300 gas when called from a <code>.send()</code> or <code>.transfer()</code>. If you wish to be able to receive Ether from a <code>.send()</code> or <code>.transfer()</code>, the most you can do in a fallback function is log an event. Use a proper function if a computation of more gas is required.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span> <span class="p">}</span>

<span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="n">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span> <span class="p">}</span>
</pre></div>

<h2 id="check-data-length-in-fallback-functions">Check data length in fallback functions<a class="headerlink" href="#check-data-length-in-fallback-functions" title="Permanent link">&para;</a></h2>
<p>Since the <a href="http://solidity.readthedocs.io/en/latest/contracts.html#fallback-function">fallback functions</a> is not only called for plain ether transfers (without data) but also when no other function matches, you should check that the data is empty if the fallback function is intended to be used only for the purpose of logging received Ether. Otherwise, callers will not notice if your contract is used incorrectly and functions that do not exist are called.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span> <span class="p">}</span>

<span class="c1">// good</span>
<span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="p">{</span> <span class="n">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span> <span class="n">LogDepositReceived</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span> <span class="p">}</span>
</pre></div>

<h2 id="explicitly-mark-payable-functions-and-state-variables">Explicitly mark payable functions and state variables<a class="headerlink" href="#explicitly-mark-payable-functions-and-state-variables" title="Permanent link">&para;</a></h2>
<p>Starting from Solidity <code>0.4.0</code>, every function that is receiving ether must use <code>payable</code> modifier, otherwise if the transaction has <code>msg.value &gt; 0</code> will revert (<a href="../recommendations/#remember-that-ether-can-be-forcibly-sent-to-an-account">except when forced</a>).</p>
<p>Declare variables and especially function arguments as <code>address payable</code>, if you want to call <code>transfer</code> on them. You can use <code>.transfer(..)</code> and <code>.send(..)</code> on <code>address payable</code>, but not on <code>address</code>. You can use a low-level <code>.call(..)</code> on both <code>address</code> and <code>address payable</code>, even if you attach value to it. This is not recommended.<sup><a href='https://ethereum.stackexchange.com/questions/64108/whats-the-difference-between-address-and-address-payable'>*</a></sup></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Something that might not be obvious: The <code>payable</code> modifier only applies to calls from <em>external</em> contracts. If I call a non-payable function in the payable function in the same contract, the non-payable function won't fail, though <code>msg.value</code> is still set</p>
</div>
<h2 id="explicitly-mark-visibility-in-functions-and-state-variables">Explicitly mark visibility in functions and state variables<a class="headerlink" href="#explicitly-mark-visibility-in-functions-and-state-variables" title="Permanent link">&para;</a></h2>
<p>Explicitly label the visibility of functions and state variables. Functions can be specified as being <code>external</code>, <code>public</code>, <code>internal</code> or <code>private</code>. Please understand the differences between them, for example, <code>external</code> may be sufficient instead of <code>public</code>. For state variables, <code>external</code> is not possible. Labeling the visibility explicitly will make it easier to catch incorrect assumptions about who can call the function or access the variable.</p>
<ul>
<li><code>External</code> functions are part of the contract interface. An external function <code>f</code> cannot be called internally (i.e. <code>f()</code> does not work, but <code>this.f()</code> works). External functions are sometimes more efficient when they receive large arrays of data.</li>
<li><code>Public</code> functions are part of the contract interface and can be either called internally or via messages. For public state variables, an automatic getter function (see below) is generated.</li>
<li><code>Internal</code> functions and state variables can only be accessed internally, without using <code>this</code>.</li>
<li><code>Private</code> functions and state variables are only visible for the contract they are defined in and not in derived contracts. <strong>Note</strong>: Everything that is inside a contract is visible to all observers external to the blockchain, even <code>Private</code> variables.<sup><a href='https://solidity.readthedocs.io/en/develop/contracts.html?#visibility-and-getters'>*</a></sup></li>
</ul>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kt">uint</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// the default is internal for state variables, but it should be made explicit</span>
<span class="kd">function</span> <span class="n">buy</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// the default is public</span>
    <span class="c1">// public code</span>
<span class="p">}</span>

<span class="c1">// good</span>
<span class="kt">uint</span> <span class="kr">private</span> <span class="n">y</span><span class="p">;</span>
<span class="kd">function</span> <span class="n">buy</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="c1">// only callable externally or using this.buy()</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">utility</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// callable externally, as well as internally: changing this code requires thinking about both cases.</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">internalAction</span><span class="p">()</span> <span class="kr">internal</span> <span class="p">{</span>
    <span class="c1">// internal code</span>
<span class="p">}</span>
</pre></div>

<h2 id="lock-pragmas-to-specific-compiler-version">Lock pragmas to specific compiler version<a class="headerlink" href="#lock-pragmas-to-specific-compiler-version" title="Permanent link">&para;</a></h2>
<p>Contracts should be deployed with the same compiler version and flags that they have been tested the most with. Locking the pragma helps ensure that contracts do not accidentally get deployed using, for example, the latest compiler which may have higher risks of undiscovered bugs. Contracts may also be deployed by others and the pragma indicates the compiler version intended by the original authors.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>


<span class="c1">// good</span>
<span class="kr">pragma solidity</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
</pre></div>

<p>Note: a floating pragma version (ie. <code>^0.4.25</code>) will compile fine with <code>0.4.26-nightly.2018.9.25</code>, however nightly builds should never be used to compile code for production.</p>
<h3 id="exception">Exception<a class="headerlink" href="#exception" title="Permanent link">&para;</a></h3>
<p>Pragma statements can be allowed to float when a contract is intended for consumption by other developers, as in the case with contracts in a library or EthPM package. Otherwise, the developer would need to manually update the pragma in order to compile locally.</p>
<h2 id="use-events-to-monitor-contract-activity">Use events to monitor contract activity<a class="headerlink" href="#use-events-to-monitor-contract-activity" title="Permanent link">&para;</a></h2>
<p>It can be useful to have a way to monitor the contract's activity after it was deployed. One way to accomplish this is to look at all transactions of the contract, however that may be insufficient, as message calls between contracts are not recorded in the blockchain. Moreover, it shows only the input parameters, not the actual changes being made to the state. Also events could be used to trigger functions in the user interface.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Charity</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">donate</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Game</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">buyCoins</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// 5% goes to charity</span>
        <span class="n">charity</span><span class="p">.</span><span class="n">donate</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Here, <code>Game</code> contract will make an internal call to <code>Charity.donate()</code>. This transaction won't appear in the external transaction list of <code>Charity</code>, but only visible in the internal transactions.</p>
<p>An event is a convenient way to log something that happened in the contract. Events that were emitted stay in the blockchain along with the other contract data and they are available for future audit. Here is an improvement to the example above, using events to provide a history of the Charity's donations.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Charity</span> <span class="p">{</span>
    <span class="c1">// define event</span>
    <span class="kd">event</span> <span class="n">LogDonate</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_amount</span><span class="p">);</span>

    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">donate</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="c1">// emit event</span>
        <span class="n">emit</span> <span class="n">LogDonate</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Game</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">buyCoins</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// 5% goes to charity</span>
        <span class="n">charity</span><span class="p">.</span><span class="n">donate</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Here, all transactions that go through the <code>Charity</code> contract, either directly or not, will show up in the event list of that contract along with the amount of donated money.</p>
<h2 id="prefer-newer-solidity-constructs">Prefer newer Solidity constructs<a class="headerlink" href="#prefer-newer-solidity-constructs" title="Permanent link">&para;</a></h2>
<p>Prefer constructs/aliases such as <code>selfdestruct</code> (over <code>suicide</code>) and <code>keccak256</code> (over <code>sha3</code>).  Patterns like <code>require(msg.sender.send(1 ether))</code> can also be simplified to using <code>transfer()</code>, as in <code>msg.sender.transfer(1 ether)</code>. Check out <a href="https://github.com/ethereum/solidity/blob/develop/Changelog.md">Solidity Change log</a> for more similar changes.</p>
<h2 id="be-aware-that-built-ins-can-be-shadowed">Be aware that 'Built-ins' can be shadowed<a class="headerlink" href="#be-aware-that-built-ins-can-be-shadowed" title="Permanent link">&para;</a></h2>
<p>It is currently possible to <a href="https://en.wikipedia.org/wiki/Variable_shadowing">shadow</a> built-in globals in Solidity. This allows contracts to override the functionality of built-ins such as <code>msg</code> and <code>revert()</code>. Although this <a href="https://github.com/ethereum/solidity/issues/1249">is intended</a>, it can mislead users of a contract as to the contract's true behavior.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">PretendingToRevert</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">revert</span><span class="p">()</span> <span class="kr">internal</span> <span class="kr">constant</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">ExampleContract</span> <span class="kr">is</span> <span class="n">PretendingToRevert</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">somethingBad</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">revert</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Contract users (and auditors) should be aware of the full smart contract source code of any application they intend to use.</p>
<h2 id="avoid-using-txorigin">Avoid using <code>tx.origin</code><a class="headerlink" href="#avoid-using-txorigin" title="Permanent link">&para;</a></h2>
<p>Never use <code>tx.origin</code> for authorization, another contract can have a method which will call your contract (where the user has some funds for instance) and your contract will authorize that transaction as your address is in <code>tx.origin</code>.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">MyContract</span> <span class="p">{</span>

    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">MyContract</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">sendTo</span><span class="p">(</span><span class="kt">address</span> <span class="n">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">require</span><span class="p">(</span><span class="nb">tx</span><span class="p">.</span><span class="n">origin</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="n">receiver</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">contract</span> <span class="n">AttackingContract</span> <span class="p">{</span>

    <span class="n">MyContract</span> <span class="n">myContract</span><span class="p">;</span>
    <span class="kt">address</span> <span class="n">attacker</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">AttackingContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">myContractAddress</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">myContract</span> <span class="o">=</span> <span class="n">MyContract</span><span class="p">(</span><span class="n">myContractAddress</span><span class="p">);</span>
        <span class="n">attacker</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">myContract</span><span class="p">.</span><span class="n">sendTo</span><span class="p">(</span><span class="n">attacker</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>

<p>You should use <code>msg.sender</code> for authorization (if another contract calls your contract <code>msg.sender</code> will be the address of the contract and not the address of the user who called the contract).</p>
<p>You can read more about it here: <a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#tx-origin">Solidity docs</a></p>
<p>Besides the issue with authorization, there is a chance that <code>tx.origin</code> will be removed from the Ethereum protocol in the future, so code that uses <code>tx.origin</code> won't be compatible with future releases <a href="https://ethereum.stackexchange.com/questions/196/how-do-i-make-my-dapp-serenity-proof/200#200">Vitalik: 'Do NOT assume that tx.origin will continue to be usable or meaningful.'</a></p>
<p>It's also worth mentioning that by using <code>tx.origin</code> you're limiting interoperability between contracts because the contract that uses tx.origin cannot be used by another contract as a contract can't be the <code>tx.origin</code>.</p>
<h2 id="timestamp-dependence">Timestamp Dependence<a class="headerlink" href="#timestamp-dependence" title="Permanent link">&para;</a></h2>
<p>There are three main considerations when using a timestamp to execute a critical function in a contract, especially when actions involve fund transfer.</p>
<h3 id="timestamp-manipulation">Timestamp Manipulation<a class="headerlink" href="#timestamp-manipulation" title="Permanent link">&para;</a></h3>
<p>Be aware that the timestamp of the block can be manipulated by a miner. Consider this <a href="https://etherscan.io/address/0xcac337492149bdb66b088bf5914bedfbf78ccc18#code">contract</a>:</p>
<div class="highlight"><pre><span></span><span class="kt">uint256</span> <span class="kr">constant</span> <span class="kr">private</span> <span class="n">salt</span> <span class="o">=</span>  <span class="nb">block</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span>

<span class="kd">function</span> <span class="n">random</span><span class="p">(</span><span class="kt">uint</span> <span class="n">Max</span><span class="p">)</span> <span class="kr">constant</span> <span class="kr">private</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">result</span><span class="p">){</span>
    <span class="c1">//get the best seed for randomness</span>
    <span class="kt">uint256</span> <span class="n">x</span> <span class="o">=</span> <span class="n">salt</span> <span class="o">*</span> <span class="mi">100</span><span class="o">/</span><span class="n">Max</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">y</span> <span class="o">=</span> <span class="n">salt</span> <span class="o">*</span> <span class="nb">block</span><span class="p">.</span><span class="n">number</span><span class="o">/</span><span class="p">(</span><span class="n">salt</span> <span class="o">%</span> <span class="mi">5</span><span class="p">)</span> <span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">seed</span> <span class="o">=</span> <span class="nb">block</span><span class="p">.</span><span class="n">number</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">salt</span> <span class="o">%</span> <span class="mi">300</span><span class="p">)</span> <span class="o">+</span> <span class="n">Last_Payout</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="n">h</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="nb">block</span><span class="p">.</span><span class="n">blockhash</span><span class="p">(</span><span class="n">seed</span><span class="p">));</span>

    <span class="k">return</span> <span class="kt">uint256</span><span class="p">((</span><span class="n">h</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span> <span class="o">%</span> <span class="n">Max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//random number between 1 and Max</span>
<span class="p">}</span>
</pre></div>

<p>When the contract uses the timestamp to seed a random number, the miner can actually post a timestamp within 15 seconds of the block being validated, effectively allowing the miner to precompute an option more favorable to their chances in the lottery. Timestamps are not random and should not be used in that context.</p>
<h3 id="the-15-second-rule">The 15-second Rule<a class="headerlink" href="#the-15-second-rule" title="Permanent link">&para;</a></h3>
<p>The <a href="http://yellowpaper.io/">Yellow Paper</a> (Ethereum's reference specification) does not specify a constraint on how much blocks can drift in time, but <a href="https://ethereum.stackexchange.com/a/5926/46821">it does specify</a> that each timestamp should be bigger than the timestamp of its parent. Popular Ethereum protocol implementations <a href="https://github.com/ethereum/go-ethereum/blob/4e474c74dc2ac1d26b339c32064d0bac98775e77/consensus/ethash/consensus.go#L45">Geth</a> and <a href="https://github.com/paritytech/parity-ethereum/blob/73db5dda8c0109bb6bc1392624875078f973be14/ethcore/src/verification/verification.rs#L296-L307">Parity</a> both reject blocks with timestamp more than 15 seconds in future. Therefore, a good rule of thumb in evaluating timestamp usage is:</p>
<blockquote>
<p>If the contract function can tolerate a 15-second drift in time, it is safe to use <code>block.timestamp</code></p>
</blockquote>
<p>If the scale of your time-dependent event can vary by 15 seconds and maintain integrity, it is safe to use a timestamp.</p>
<h3 id="avoid-using-blocknumber-as-a-timestamp">Avoid using <code>block.number</code> as a timestamp<a class="headerlink" href="#avoid-using-blocknumber-as-a-timestamp" title="Permanent link">&para;</a></h3>
<p>It is possible to estimate a time delta using the <code>block.number</code> property and <a href="https://etherscan.io/chart/blocktime">average block time</a>, however this is not future proof as block times may change (such as <a href="https://blog.ethereum.org/2015/08/08/chain-reorganisation-depth-expectations/">fork reorganisations</a> and the <a href="https://github.com/ethereum/EIPs/issues/649">difficulty bomb</a>). In a sale spanning days, the 15-second rule allows one to achieve a more reliable estimate of time.</p>
<h2 id="multiple-inheritance-caution">Multiple Inheritance Caution<a class="headerlink" href="#multiple-inheritance-caution" title="Permanent link">&para;</a></h2>
<p>When utilizing multiple inheritance in Solidity, it is important to understand how the compiler composes the inheritance graph.</p>
<p><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Final</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">a</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">Final</span><span class="p">(</span><span class="kt">uint</span> <span class="n">f</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">B</span> <span class="kr">is</span> <span class="n">Final</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="kr">public</span> <span class="n">fee</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">B</span><span class="p">(</span><span class="kt">uint</span> <span class="n">f</span><span class="p">)</span> <span class="n">Final</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="n">setFee</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">fee</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="kr">is</span> <span class="n">Final</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="kr">public</span> <span class="n">fee</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">C</span><span class="p">(</span><span class="kt">uint</span> <span class="n">f</span><span class="p">)</span> <span class="n">Final</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="n">setFee</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">fee</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="kr">is</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="n">A</span><span class="p">()</span> <span class="kr">public</span> <span class="n">B</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="n">C</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">setFee</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
When a contract is deployed, the compiler will <em>linearize</em> the inheritance from right to left (after the keyword <em>is</em> the parents are listed from the most base-like to the most derived). Here is contract A's linearization:</p>
<p><strong>Final &lt;- B &lt;- C &lt;- A</strong></p>
<p>The consequence of the linearization will yield a <code>fee</code> value of 5, since C is the most derived contract. This may seem obvious, but imagine scenarios where C is able to shadow crucial functions, reorder boolean clauses, and cause the developer to write exploitable contracts. Static analysis currently does not raise issue with overshadowed functions, so it must be manually inspected.</p>
<p>For more on security and inheritance, check out this <a href="https://pdaian.com/blog/solidity-anti-patterns-fun-with-inheritance-dag-abuse/">article</a></p>
<p>To help contribute, Solidity's Github has a <a href="https://github.com/ethereum/solidity/projects/9#card-8027020">project</a> with all inheritance-related issues.</p>
<h2 id="use-interface-type-instead-of-the-address-for-type-safety">Use interface type instead of the address for type safety<a class="headerlink" href="#use-interface-type-instead-of-the-address-for-type-safety" title="Permanent link">&para;</a></h2>
<p>When a function takes a contract address as an argument, it is better to pass an interface or contract type rather than raw <code>address</code>. If the function is called elsewhere within the source code, the compiler it will provide additional type safety guarantees.</p>
<p>Here we see two alternatives:</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Validator</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">validate</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TypeSafeAuction</span> <span class="p">{</span>
    <span class="c1">// good</span>
    <span class="kd">function</span> <span class="n">validateBet</span><span class="p">(</span><span class="n">Validator</span> <span class="n">_validator</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">_validator</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">_value</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">valid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TypeUnsafeAuction</span> <span class="p">{</span>
    <span class="c1">// bad</span>
    <span class="kd">function</span> <span class="n">validateBet</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="kr">internal</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(</span><span class="n">_addr</span><span class="p">);</span>
        <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">validator</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">_value</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">valid</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The benefits of using the <code>TypeSafeAuction</code> contract above can then be seen from the following example. If <code>validateBet()</code> is called with an <code>address</code> argument, or a contract type other than <code>Validator</code>, the compiler will throw this error:</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">NonValidator</span><span class="p">{}</span>

<span class="kd">contract</span> <span class="n">Auction</span> <span class="kr">is</span> <span class="n">TypeSafeAuction</span> <span class="p">{</span>
    <span class="n">NonValidator</span> <span class="n">nonValidator</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">bet</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">validateBet</span><span class="p">(</span><span class="n">nonValidator</span><span class="p">,</span> <span class="n">_value</span><span class="p">);</span> <span class="c1">// TypeError: Invalid type for argument in function call.</span>
                                                        <span class="c1">// Invalid implicit conversion from contract NonValidator</span>
                                                        <span class="c1">// to contract Validator requested.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2 id="avoid-using-extcodesize-to-check-for-externally-owned-accounts">Avoid using <code>extcodesize</code> to check for Externally Owned Accounts<a class="headerlink" href="#avoid-using-extcodesize-to-check-for-externally-owned-accounts" title="Permanent link">&para;</a></h2>
<p>The following modifier (or a similar check) is often used to verify whether a call was made from an externally owned account (EOA) or a contract account:</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">modifier</span> <span class="n">isNotContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">_a</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">uint</span> <span class="n">size</span><span class="p">;</span>
  <span class="k">assembly</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">:=</span> <span class="nf">extcodesize</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span>
  <span class="p">}</span>
    <span class="n">require</span><span class="p">(</span><span class="n">size</span> <span class="err">==</span> <span class="mi">0</span><span class="p">)</span><span class="err">;</span>
     <span class="n">_</span><span class="err">;</span>
<span class="p">}</span>
</pre></div>

<p>The idea is straight forward: if an address contains code, it's not an EOA but a contract account. However, <strong>a contract does not have source code available during construction</strong>. This means that while the constructor is running, it can make calls to other contracts, but <code>extcodesize</code> for its address returns zero. Below is a minimal example that shows how this check can be circumvented:</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">OnlyForEOA</span> <span class="p">{</span>    
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">flag</span><span class="p">;</span>

    <span class="c1">// bad</span>
    <span class="kd">modifier</span> <span class="n">isNotContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">_a</span><span class="p">){</span>
        <span class="kt">uint</span> <span class="n">len</span><span class="p">;</span>
        <span class="k">assembly</span> <span class="p">{</span> <span class="n">len</span> <span class="o">:=</span> <span class="nf">extcodesize</span><span class="p">(</span><span class="n">_a</span><span class="p">)</span> <span class="p">}</span>
        <span class="n">require</span><span class="p">(</span><span class="n">len</span> <span class="err">==</span> <span class="mi">0</span><span class="p">)</span><span class="err">;</span>
        <span class="n">_</span><span class="err">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">setFlag</span><span class="p">(</span><span class="kt">uint</span> <span class="n">i</span><span class="p">)</span> <span class="kr">public</span> <span class="n">isNotContract</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">){</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">FakeEOA</span> <span class="p">{</span>
    <span class="n">constructor</span><span class="p">(</span><span class="kt">address</span> <span class="n">_a</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">OnlyForEOA</span> <span class="n">c</span> <span class="o">=</span> <span class="n">OnlyForEOA</span><span class="p">(</span><span class="n">_a</span><span class="p">);</span>
        <span class="n">c</span><span class="p">.</span><span class="n">setFlag</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Because contract addresses can be pre-computed, this check could also fail if it checks an address which is empty at block <code>n</code>, but which has a contract deployed to it at some block greater than <code>n</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This issue is nuanced.</p>
<p>If your goal is to prevent other contracts from being able to call your contract, the <code>extcodesize</code> check is probably sufficient. An alternative approach is to check the value of <code>(tx.origin == msg.sender)</code>, though this also <a href="../recommendations/#avoid-using-txorigin">has drawbacks</a>.</p>
<p>There may be other situations in which the <code>extcodesize</code> check serves your purpose. Describing all of them here is out of scope. Understand the underlying behaviors of the EVM and use your Judgement.</p>
</div>
<h2 id="deprecatedhistorical-recommendations">Deprecated/historical recommendations<a class="headerlink" href="#deprecatedhistorical-recommendations" title="Permanent link">&para;</a></h2>
<p>These are recommendations which are no longer relevant due to changes in the protocol or improvements to solidity. They are recorded here for posterity and awareness.</p>
<h3 id="beware-division-by-zero-solidity-04">Beware division by zero (Solidity &lt; 0.4)<a class="headerlink" href="#beware-division-by-zero-solidity-04" title="Permanent link">&para;</a></h3>
<p>Prior to version 0.4, Solidity <a href="https://github.com/ethereum/solidity/issues/670">returns zero</a> and does not <code>throw</code> an exception when a number is divided by zero. Ensure you're running at least version 0.4.</p>
<h3 id="differentiate-functions-and-events-solidity-0421">Differentiate functions and events (Solidity &lt; 0.4.21)<a class="headerlink" href="#differentiate-functions-and-events-solidity-0421" title="Permanent link">&para;</a></h3>
<p>In <a href="https://github.com/ethereum/solidity/blob/develop/Changelog.md#0421-2018-03-07">v0.4.21</a> Solidity introduced the <code>emit</code> keyword to indicate an event <code>emit EventName();</code>. As of 0.5.0, it is required.</p>
<p>Favor capitalization and a prefix in front of events (we suggest <em>Log</em>), to prevent the risk of confusion between functions and events. For functions, always start with a lowercase letter, except for the constructor.</p>
<div class="highlight"><pre><span></span><span class="c1">// bad</span>
<span class="kd">event</span> <span class="n">Transfer</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="n">transfer</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// good</span>
<span class="kd">event</span> <span class="n">LogTransfer</span><span class="p">()</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="n">transfer</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{}</span>
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">

        <!-- Link to previous page -->
        
          <a href="../general_philosophy/"
              title="General Philosophy"
              class="md-flex md-footer-nav__link md-footer-nav__link--prev"
              rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back
                    md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                General Philosophy
              </span>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a href="../known_attacks/" title="Known Attacks"
              class="md-flex md-footer-nav__link md-footer-nav__link--next"
              rel="next">
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Known Attacks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward
                    md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>

      <!-- Customization: Diligence info -->
      <div class="md-footer-diligence">

        maintained by
        <a href="https://diligence.consensys.net" target="_blank" rel="noopener">
          <img src="../assets/images/diligence_logo.svg" />
          ConsenSys Diligence
        </a>
      </div>

      <!-- Social links -->
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>